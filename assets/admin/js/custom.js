jQuery(document).ready(function(){var d=jQuery(".vsu-admin-wrap"),b=jQuery('<div class="vsu-admin-loader"/>').hide().appendTo(d).text("saving...").wrapInner('<div class="vsu-admin-loader-text"/>'),c=jQuery(".vsu-admin-position",d).val(),e=false;function a(i){i=i||"saving...";b.find(".vsu-admin-loader-text").text(i);b.fadeIn(300)}function h(){b.hide()}function g(){(function(l){var o=l("[data-export-base]",d),k=o.data("exportBase"),j=l("#vsu_admin-settings-license_key",d).val(),n=l('[name="vsu-filter[action]"]',d).val(),m=l('[name="vsu-filter[number]"]',d).val();var i=k+"&"+decodeURIComponent(l.param({key:j,filter_action:n,filter_number:m}));o.attr("href",i)}(jQuery))}(function(i){i(".vsu-admin-field-verify",d).after('<div class="vsu-admin-status"/>')}(jQuery));(function(i){i(".vsu-admin-see-variables a",d).on("click",function(j){j.preventDefault();i(this).next("table").slideToggle("fast")})}(jQuery));(function(i){i(".vsu-admin-color-picker",d).wpColorPicker()}(jQuery));(function(i){i(".vsu-admin-input-copy",d).on("click",function(){this.select()})}(jQuery));function f(){jQuery(".vsu-admin-navigation li.vsu-admin-active",d).next().find("a").trigger("click")}(function(i){i('.vsu-admin-navigation li:not(.vsu-admin-active) > a[href^="#"]',d).on("click",function(l){l.preventDefault();var k=i(this),j=i(k.attr("href"));i(".vsu-admin-navigation li.vsu-admin-active",d).removeClass("vsu-admin-active");i(".vsu-admin-section",d).hide();k.parent().addClass("vsu-admin-active");j.fadeIn(300,function(){j.trigger("vsu.after_show")});c=k.parent().index()});i(".vsu-admin-navigation li:eq("+c+") > a",d).trigger("click")}(jQuery));(function(l){function m(o){l("#vsu_admin-settings-first_name",d).val(o.first_name);l("#vsu_admin-settings-email",d).val(o.email)}function k(){l("#vsu-admin-form-settings-account",d).trigger("reset")}var j=l("#vsu-admin-form-settings-license",d),n=j.find("#vsu_admin-settings-license_key"),i=j.find('[type="submit"]');n.on("change input",function(){i.attr("disabled",(l.trim(n.val())===""))}).trigger("change");l("#vsu-admin-form-settings-license",d).on("submit",function(p){p.preventDefault();var o=l(this);if(l.trim(n.val())!==""){a();l.post(ajaxurl,{action:"vsu_save_license",data:o.serialize(),position:c},function(q){if(q.message!==""){alert(q.message)}if(q.state==="success"&&q.data){e=false;if(n.length>0){if(n.val()===""){n.removeAttr("data-vsu-admin-state")}else{if(q.data.api_verified===0){var r="limit_reached"}else{var r=q.data.api_verified?"verified":"unverified"}n.attr("data-vsu-admin-state",r);if(r==="verified"){f();g()}}}if(q.data.account_details!==false){m(q.data.account_details)}}h()},"json")}});l("#vsu-admin-form-settings-account",d).on("submit",function(p){p.preventDefault();var o=l(this);a();l.post(ajaxurl,{action:"vsu_save_account",data:o.serialize(),position:c},function(q){if(q.state==="error"){alert(q.message)}if(q.state==="success"){if(q.data!==false){var r=q.data;if("error" in r){alert(r.error)}else{if(r.api_key){n.val(r.api_key).trigger("change")}n.attr("data-vsu-admin-state",r.api_key_status)}}}h()},"json")})}(jQuery));(function(m){function k(t){var s=m('<p class="vsu-antispam-field"/>'),r=m("<label>").text(VSU_Admin.antispam).appendTo(s),u=m("<input/>",{name:"vsu_antispam","class":"vsu-antispam-check",type:"checkbox",value:"yes"}).appendTo(r);m('<div class="vsu-tickbox"/>').insertAfter(u);t.append(s);return s}var o=m("#vsu-admin-signup-form-preview"),n=m(".vsu-signup-button",o),q=m("#vsu_admin-email_form-button_color"),l=m("#vsu_admin-email_form-button_text");var p=k(o.find(".vsu-signup-form")),j=m("#vsu_admin-email_form-antispam_enabled");function i(){p.toggle(j.is(":checked"))}j.on("click",function(){i()});i();if(n.length>0){q.wpColorPicker({change:function(r,s){n.css("background-color",q.wpColorPicker("color"))}})}if(l.length>0){l.on("input change",function(){n.val(l.val())})}}(jQuery));(function(j){var i=j("#vsu_admin-autoresponders-signup_full_text");if(i.length>0){var k=j("#"+i.data("previewContainer"));i.on("input change",function(){k.text(i.val())})}}(jQuery));(function(j){j("#vsu-admin-form-popup_content",d).on("submit",function(l){l.preventDefault();var k=j(this);a();j.post(ajaxurl,{action:"vsu_save_popup_content",data:k.serialize(),position:c,section_ID:"popup_content"},function(m){if(m.state==="error"){alert(m.message)}if(m.state==="success"){j.each(m.data,function(p,o){var n=j('[data-vsu-live="'+p+'"]',d);if(o===false){o=""}if(n.length>0){if(p==="ref_number"){o=parseInt(o)||0}n.text(o);if(p==="promo_page"){n.attr("href",p)}}});f()}h()},"json")});function i(){var k=j("#vsu_admin-popup_content-promo_text",d),l=j('[data-vsu-live="promo_text"]',d),p=j("#vsu_admin-popup_content-ref_number",d),n=j('[data-vsu-live="ref_number"]',d),m=j("#vsu_admin-popup_content-credit_line_on",d),q=j(".vsu-powered-by",d);k.on("change input",function(){l.text(k.val())});p.on("change input",function(){n.text(parseInt(p.val())||0)});function o(){q.toggle(m.is(":checked"))}o();m.on("change",function(){o()})}i()}(jQuery));(function(i){i(".vsu-admin-form[data-vsu-section-id]",d).on("submit",function(k){k.preventDefault();var j=i(this);a();i.post(ajaxurl,{action:"vsu_save_general",data:j.serialize(),position:c,section_ID:j.data("vsuSectionId")},function(l){if(l.state==="error"){alert(l.message)}if(l.state==="success"){f()}h()},"json")})}(jQuery));(function(n){var s=n("#vsu-admin-section-signups",d);s.addClass("vsu-state-loading vsu-state-total-loading");s.on("click",".vsu-admin-referred-count",function(){n(this).toggleClass("active")});n(document).click(function(v){var u=n(v.target).closest(".vsu-admin-referred-count");s.find(".vsu-admin-referred-count.active").not(u).removeClass("active")});function i(){var u=n('<table class="vsu-admin-signups-table"/>');n("<th>").text(VSU_Admin.signup_page_email_label).appendTo(u);n("<th>").appendTo(u);n("<th>").text(VSU_Admin.signup_page_refer_label).appendTo(u);u.wrapInner("<thead/>");n("<tbody/>").appendTo(u);return u}function m(v){var u=n('<ul class="vsu-admin-referred-emails"/>');n.each(v,function(x,w){n("<a/>",{href:"mailto:"+w}).text(w).appendTo(u).wrap("<li/>")});return u}function o(y){if(y==="no_results"){var x=n('<td colspan="3"/>').text(VSU_Admin.no_results_text);k.find("tbody").html(x).wrapInner('<tr class="vsu-admin-no-results-row"/>');return}k.find(".vsu-admin-no-results-row").remove();var w=y.id;var u=n('<tr id="vsu-admin-signup-'+w+'"/>').data("signupID",w);n("<a/>",{href:"mailto:"+y.email}).text(y.email).appendTo(u).wrap('<td width="35%"/>');if(parseInt(y.refer_n)>0){n('<a href="#vsu-admin-referred-emails-'+w+'" class="vsu-admin-referred-count"/>').html(n("<span/>").text(y.refer_n)).append(m(y.refer_emails)).appendTo(u).wrap('<td width="5%"/>')}else{n('<td width="5%"/>').appendTo(u)}var v=(y.refer_addr!=="")?y.refer_addr:VSU_Admin.signup_page_empty_referrer_site;n("<a/>",{href:y.refer_addr}).text(v).appendTo(u).wrap('<td width="60%"/>');u.hide().appendTo(k.find("tbody")).fadeIn(300);l++}var k=i();k.insertAfter(".vsu-admin-signups-header",s);var t=n(".vsu-admin-load-more-button",s),j=t.val(),q=n(".vsu-admin-total-signups-number",s),p=n(".vsu-admin-total-shared-number",s),r=n("#vsu-admin-signup-filter-form",s),l=0;s.on("vsu.after_show",function(){if(!e){s.trigger("vsu.load_signup_data")}}).on("vsu.load_signup_data",function(w,x){x=x||false;var v=t.data("vsuPage")||1,u=!e&&!x;if(!e){k.find("tbody").empty();s.addClass("vsu-state-loading");l=0}if(u){s.addClass("vsu-state-total-loading")}t.attr("disabled","disabled");n.post(ajaxurl,{action:"vsu_get_signups",page:v,get_total:u,filter_action:r.find('[name="vsu-filter[action]"]').val(),filter_number:r.find('[name="vsu-filter[number]"]').val()},function(y){if(y.state==="error"){s.removeClass("vsu-state-loading").removeClass("vsu-state-total-loading");t.hide();alert(y.message);return}if("total" in y.data){q.text(y.data.total.signups);p.text(y.data.total.refers)}t.data("vsuPage",++v);s.removeClass("vsu-state-loading").removeClass("vsu-state-total-loading");if(!n.isEmptyObject(y.data.data)){n.each(y.data.data,function(z,A){o(A)})}else{o("no_results")}t.toggle(y.data.load_more);t.val(j).removeAttr("disabled");r.find(":input").removeAttr("disabled");e=true;h()},"json")}).on("click",".vsu-admin-load-more-button",function(u){u.preventDefault();t.val(VSU_Admin.loading_text);s.trigger("vsu.load_signup_data")});r.on("submit",function(u){u.preventDefault();r.find(":input").attr("disabled","disabled");e=false;t.data("vsuPage",1).hide();s.trigger("vsu.load_signup_data",[true])}).on("change",function(){g()})}(jQuery))});