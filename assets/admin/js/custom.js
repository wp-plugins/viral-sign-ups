jQuery(document).ready(function(){var d=jQuery(".vsu-admin-wrap"),b=jQuery('<div class="vsu-admin-loader"/>').hide().appendTo(d).text("saving...").wrapInner('<div class="vsu-admin-loader-text"/>'),c=jQuery(".vsu-admin-position",d).val(),e=false;function a(i){i=i||"saving...";b.find(".vsu-admin-loader-text").text(i);b.fadeIn(300)}function h(){b.hide()}function g(){(function(l){var o=l("[data-export-base]",d),k=o.data("exportBase"),j=l("#vsu_admin-settings-license_key",d).val(),n=l('[name="vsu-filter[action]"]',d).val(),m=l('[name="vsu-filter[number]"]',d).val();var i=k+"&"+decodeURIComponent(l.param({key:j,filter_action:n,filter_number:m}));o.attr("href",i)}(jQuery))}(function(i){i(".vsu-admin-field-verify",d).after('<div class="vsu-admin-status"/>')}(jQuery));(function(i){i(".vsu-admin-see-variables a",d).on("click",function(j){j.preventDefault();i(this).next("table").slideToggle("fast")})}(jQuery));(function(i){i(".vsu-admin-color-picker",d).wpColorPicker()}(jQuery));(function(i){i(".vsu-admin-input-copy",d).on("click",function(){this.select()})}(jQuery));function f(){jQuery(".vsu-admin-navigation li.vsu-admin-active",d).next().find("a").trigger("click")}(function(i){i('.vsu-admin-navigation li:not(.vsu-admin-active) > a[href^="#"]',d).on("click",function(l){l.preventDefault();var k=i(this),j=i(k.attr("href"));i(".vsu-admin-navigation li.vsu-admin-active",d).removeClass("vsu-admin-active");i(".vsu-admin-section",d).hide();k.parent().addClass("vsu-admin-active");j.fadeIn(300,function(){j.trigger("vsu.after_show")});c=k.parent().index()});i(".vsu-admin-navigation li:eq("+c+") > a",d).trigger("click")}(jQuery));(function(i){var j=i("#vsu-admin-form-settings #vsu_admin-settings-license_key");i("#vsu-admin-form-settings",d).on("submit",function(l){l.preventDefault();var k=i(this);a();i.post(ajaxurl,{action:"vsu_save_settings",data:k.serialize(),position:c},function(m){if(m.state==="error"){alert(m.message)}if(m.state==="success"){e=false;if(j.length>0){if(j.val()===""){j.removeAttr("data-vsu-admin-state")}else{if(m.data.api_verified===0){var n="limit_reached"}else{var n=m.data.api_verified?"verified":"unverified"}j.attr("data-vsu-admin-state",n);if(n==="verified"){f();g()}}}}h()},"json")})}(jQuery));(function(m){function k(t){var s=m('<p class="vsu-antispam-field"/>'),r=m("<label>").text(VSU_Admin.antispam).appendTo(s),u=m("<input/>",{name:"vsu_antispam","class":"vsu-antispam-check",type:"checkbox",value:"yes"}).appendTo(r);m('<div class="vsu-tickbox"/>').insertAfter(u);t.append(s);return s}var o=m("#vsu-admin-signup-form-preview"),n=m(".vsu-signup-button",o),q=m("#vsu_admin-email_form-button_color"),l=m("#vsu_admin-email_form-button_text");var p=k(o.find(".vsu-signup-form")),j=m("#vsu_admin-email_form-antispam_enabled");function i(){p.toggle(j.is(":checked"))}j.on("click",function(){i()});i();if(n.length>0){q.wpColorPicker({change:function(r,s){n.css("background-color",q.wpColorPicker("color"))}})}if(l.length>0){l.on("input change",function(){n.val(l.val())})}}(jQuery));(function(j){var i=j("#vsu_admin-autoresponders-signup_full_text");if(i.length>0){var k=j("#"+i.data("previewContainer"));i.on("input change",function(){k.text(i.val())})}}(jQuery));(function(j){j("#vsu-admin-form-popup_content",d).on("submit",function(l){l.preventDefault();var k=j(this);a();j.post(ajaxurl,{action:"vsu_save_popup_content",data:k.serialize(),position:c,section_ID:"popup_content"},function(m){if(m.state==="error"){alert(m.message)}if(m.state==="success"){j.each(m.data,function(p,o){var n=j('[data-vsu-live="'+p+'"]',d);if(o===false){o=""}if(n.length>0){if(p==="ref_number"){o=parseInt(o)||0}n.text(o);if(p==="promo_page"){n.attr("href",p)}}});f()}h()},"json")});function i(){var k=j("#vsu_admin-popup_content-promo_text",d),l=j('[data-vsu-live="promo_text"]',d),p=j("#vsu_admin-popup_content-ref_number",d),n=j('[data-vsu-live="ref_number"]',d),m=j("#vsu_admin-popup_content-credit_line_on",d),q=j(".vsu-powered-by",d);k.on("change input",function(){l.text(k.val())});p.on("change input",function(){n.text(parseInt(p.val())||0)});function o(){q.toggle(m.is(":checked"))}o();m.on("change",function(){o()})}i()}(jQuery));(function(i){i(".vsu-admin-form[data-vsu-section-id]",d).on("submit",function(k){k.preventDefault();var j=i(this);a();i.post(ajaxurl,{action:"vsu_save_general",data:j.serialize(),position:c,section_ID:j.data("vsuSectionId")},function(l){if(l.state==="error"){alert(l.message)}if(l.state==="success"){f()}h()},"json")})}(jQuery));(function(m){var r=m("#vsu-admin-section-signups",d);r.addClass("vsu-state-loading vsu-state-total-loading");function i(){var t=m('<table class="vsu-admin-signups-table"/>');m("<th>").text(VSU_Admin.signup_page_email_label).appendTo(t);m("<th>").appendTo(t);m("<th>").text(VSU_Admin.signup_page_refer_label).appendTo(t);t.wrapInner("<thead/>");m("<tbody/>").appendTo(t);return t}function n(x){if(x==="no_results"){var w=m('<td colspan="3"/>').text(VSU_Admin.no_results_text);k.find("tbody").html(w).wrapInner('<tr class="vsu-admin-no-results-row"/>');return}k.find(".vsu-admin-no-results-row").remove();var v=x.id;var t=m('<tr id="vsu-admin-signup-'+v+'"/>').data("signupID",v);m("<a/>",{href:"mailto:"+x.email}).text(x.email).appendTo(t).wrap('<td width="35%"/>');if(parseInt(x.refer_n)>0){m('<span class="vsu-admin-referred-count"/>').text(x.refer_n).appendTo(t).wrap('<td width="5%"/>')}else{m('<td width="5%"/>').appendTo(t)}var u=(x.refer_addr!=="")?x.refer_addr:VSU_Admin.signup_page_empty_referrer_site;m("<a/>",{href:x.refer_addr}).text(u).appendTo(t).wrap('<td width="60%"/>');t.hide().appendTo(k.find("tbody")).fadeIn(300);l++}var k=i();k.insertAfter(".vsu-admin-signups-header",r);var s=m(".vsu-admin-load-more-button",r),j=s.val(),p=m(".vsu-admin-total-signups-number",r),o=m(".vsu-admin-total-shared-number",r),q=m("#vsu-admin-signup-filter-form",r),l=0;r.on("vsu.after_show",function(){if(!e){r.trigger("vsu.load_signup_data")}}).on("vsu.load_signup_data",function(v,w){w=w||false;var u=s.data("vsuPage")||1,t=!e&&!w;if(!e){k.find("tbody").empty();r.addClass("vsu-state-loading");l=0}if(t){r.addClass("vsu-state-total-loading")}s.attr("disabled","disabled");m.post(ajaxurl,{action:"vsu_get_signups",page:u,get_total:t,filter_action:q.find('[name="vsu-filter[action]"]').val(),filter_number:q.find('[name="vsu-filter[number]"]').val()},function(x){if(x.state==="error"){r.removeClass("vsu-state-loading").removeClass("vsu-state-total-loading");s.hide();alert(x.message);return}if("total" in x.data){p.text(x.data.total.signups);o.text(x.data.total.refers)}s.data("vsuPage",++u);r.removeClass("vsu-state-loading").removeClass("vsu-state-total-loading");if(!m.isEmptyObject(x.data.data)){m.each(x.data.data,function(y,z){n(z)})}else{n("no_results")}s.toggle(x.data.load_more);s.val(j).removeAttr("disabled");q.find(":input").removeAttr("disabled");e=true;h()},"json")}).on("click",".vsu-admin-load-more-button",function(t){t.preventDefault();s.val(VSU_Admin.loading_text);r.trigger("vsu.load_signup_data")});q.on("submit",function(t){t.preventDefault();q.find(":input").attr("disabled","disabled");e=false;s.data("vsuPage",1).hide();r.trigger("vsu.load_signup_data",[true])}).on("change",function(){g()})}(jQuery))});